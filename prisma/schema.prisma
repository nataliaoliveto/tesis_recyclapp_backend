generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [citext(map: "citext")]
}

// * CRUD OK
model User {
  id                  Int             @id @default(autoincrement())
  name                String          @db.VarChar(30)
  surname             String          @db.VarChar(30)
  mail                String          @unique @db.Citext
  phone               String          @db.VarChar(20)
  password            String          @db.VarChar(20)
  username            String          @unique @db.Citext
  isArchived          Boolean         @default(false)
  address             Address[]
  Advertisement       Advertisement[]
  ChatMessageReceived ChatMessage[]   @relation("chatReceiver")
  ChatMessageSent     ChatMessage[]   @relation("chatSender")
  Post                Post[]
  Rating              Rating[]
}

// * CRUD OK
model Address {
  id           Int         @id @default(autoincrement())
  street       String      @db.VarChar(50)
  flat         String      @db.VarChar(10)
  city         String      @db.VarChar(50)
  state        String      @db.VarChar(50)
  postalCode   String      @db.VarChar(10)
  latitude     Float
  longitude    Float
  greenPointId Int?        @unique
  userId       Int?
  isArchived   Boolean     @default(false)
  GreenPoint   GreenPoint? @relation(fields: [greenPointId], references: [id])
  User         User?       @relation(fields: [userId], references: [id])
}

model UserStore {
  id          Int       @id @default(autoincrement())
  displayName String    @unique @db.Citext
  isArchived  Boolean   @default(false)
  Benefit     Benefit[]
}

model UserCustomer {
  id              Int       @id @default(autoincrement())
  pointsCurrent   Int       @default(0)
  pointsTotal     Int       @default(0)
  isArchived      Boolean   @default(false)
  benefitsActive  Benefit[] @relation("benefitsActive")
  benefitsHistory Benefit[] @relation("benefitsHistory")
}

// * CRUD OK
model Rating {
  id         Int     @id @default(autoincrement())
  text       String  @db.VarChar(255)
  value      Int
  userId     Int
  isArchived Boolean @default(false)
  user       User    @relation(fields: [userId], references: [id])
}

// * CRUD OK
model Advertisement {
  id             Int          @id @default(autoincrement())
  durationStart  DateTime     @db.Date
  durationEnd    DateTime     @db.Date
  displayName    String       @db.VarChar(30)
  text           String       @db.VarChar(255)
  userId         Int
  subscriptionId Int
  isArchived     Boolean      @default(false)
  subscription   Subscription @relation(fields: [subscriptionId], references: [id])
  user           User         @relation(fields: [userId], references: [id])
}

// * CRUD OK
model Subscription {
  id             Int             @id @default(autoincrement())
  name           String          @unique @db.Citext
  amount         Float
  duration       Int
  isArchived     Boolean         @default(false)
  advertisements Advertisement[]
}

model Benefit {
  id                    Int            @id @default(autoincrement())
  name                  String         @db.VarChar(20)
  type                  String         @db.VarChar(10)
  endDate               DateTime       @db.Date
  quantity              Int
  pointsCost            Int
  isActive              Boolean
  userStoreId           Int
  userCustomerActiveId  Int
  userCustomerHistoryId Int
  isArchived            Boolean        @default(false)
  userStore             UserStore      @relation(fields: [userStoreId], references: [id])
  userCustomerActive    UserCustomer[] @relation("benefitsActive")
  userCustomerHistory   UserCustomer[] @relation("benefitsHistory")
}

model GreenPoint {
  id                Int                 @id @default(autoincrement())
  name              String              @db.VarChar(50)
  availability      Json                @db.Json
  type              String              @db.VarChar(15)
  isArchived        Boolean             @default(false)
  Address           Address?
  materialComponent MaterialComponent[] @relation("GreenPointToMaterialComponent")
  organic           Organic[]           @relation("GreenPointToOrganic")
}

// TODO: CRUD IN PROGRESS - GREEN POINT PENDING
model Organic {
  id            Int          @id @default(autoincrement())
  name          String       @unique @db.Citext
  isCompostable Boolean
  isArchived    Boolean      @default(false)
  GreenPoint    GreenPoint[] @relation("GreenPointToOrganic")
}

// TODO: CRUD IN PROGRESS - POST PENDING
model MaterialProduct {
  id                Int                 @id @default(autoincrement())
  name              String              @unique @db.Citext
  isArchived        Boolean             @default(false)
  materialComponent MaterialComponent[] @relation("MaterialProductToMaterialComponent")
  Post              Post[]
}

// TODO: CRUD IN PROGRESS - GREEN POINT PENDING
model MaterialComponent {
  id              Int               @id @default(autoincrement())
  name            String            @unique @db.Citext
  recyclableType  RecyclableType
  description     String            @db.VarChar(1024)
  isArchived      Boolean           @default(false)
  GreenPoint      GreenPoint[]      @relation("GreenPointToMaterialComponent")
  MaterialProduct MaterialProduct[] @relation("MaterialProductToMaterialComponent")
}

enum RecyclableType {
  RECYCLABLE
  NO_RECYCLABLE
  DEPENDS
  ORGANIC
}

model Post {
  id                Int              @id @default(autoincrement())
  quantity          Int              @db.SmallInt
  description       String           @db.VarChar(255)
  purpouse          String           @db.VarChar(10)
  pointsAwared      Int
  isActive          Boolean
  isReserved        Boolean
  userId            Int
  materialProductId Int
  isArchived        Boolean          @default(false)
  Chat              Chat[]
  materialProduct   MaterialProduct  @relation(fields: [materialProductId], references: [id])
  userPost          User             @relation(fields: [userId], references: [id])
  PostCommitment    PostCommitment[]
}

model PostCommitment {
  id         Int     @id @default(autoincrement())
  tokenCode  String  @db.VarChar(25)
  isActive   Boolean
  postId     Int
  isArchived Boolean @default(false)
  post       Post    @relation(fields: [postId], references: [id])
}

model Chat {
  id          Int           @id @default(autoincrement())
  startDate   DateTime      @db.Date
  endDate     DateTime?     @db.Date
  isActive    Boolean
  postId      Int
  isArchived  Boolean       @default(false)
  post        Post          @relation(fields: [postId], references: [id])
  ChatMessage ChatMessage[]
}

model ChatMessage {
  id         Int      @id @default(autoincrement())
  timestamp  DateTime @default(now())
  message    String   @db.VarChar(255)
  senderId   Int
  receiverId Int
  chatId     Int
  isArchived Boolean  @default(false)
  chat       Chat     @relation(fields: [chatId], references: [id])
  receiver   User     @relation("chatReceiver", fields: [receiverId], references: [id])
  sender     User     @relation("chatSender", fields: [senderId], references: [id])
}
